TARGETNAME=viostor
TARGETTYPE=MINIPORT

C_DEFINES = -D_MAJORVERSION_=$(_BUILD_MAJOR_VERSION_) $(C_DEFINES)
C_DEFINES = -D_MINORVERSION_=$(_BUILD_MINOR_VERSION_) $(C_DEFINES)
C_DEFINES = -D_NT_TARGET_MAJ=$(_NT_TARGET_MAJ) $(C_DEFINES)
C_DEFINES = -D_NT_TARGET_MIN=$(_RHEL_RELEASE_VERSION_) $(C_DEFINES)

!if "$(DDK_TARGET_OS)" == "WinLH"
INF_NAME=WinLH
C_DEFINES = -DUSE_STORPORT=1 $(C_DEFINES)
C_DEFINES = -DMSI_SUPPORTED=1 $(C_DEFINES)
TARGETLIBS=$(SDK_LIB_PATH)\storport.lib ..\VirtIO\$(O)\virtiolib.lib
!elseif "$(DDK_TARGET_OS)" == "Win7"
INF_NAME=WinLH
C_DEFINES = -DUSE_STORPORT=1 $(C_DEFINES)
C_DEFINES = -DMSI_SUPPORTED=1 $(C_DEFINES)
TARGETLIBS=$(SDK_LIB_PATH)\storport.lib ..\VirtIO\$(O)\virtiolib.lib
!elseif "$(DDK_TARGET_OS)" == "WinNET"
INF_NAME=WinNET
C_DEFINES = -DUSE_STORPORT=1 $(C_DEFINES)
TARGETLIBS=$(SDK_LIB_PATH)\storport.lib ..\VirtIO\$(O)\virtiolib.lib
!elseif "$(DDK_TARGET_OS)" == "WinXP"
INF_NAME=WinXP
TARGETLIBS=$(SDK_LIB_PATH)\scsiport.lib ..\VirtIO\$(O)\virtiolib.lib
!else
INF_NAME=WinLH
C_DEFINES = -DMSI_SUPPORTED=1 $(C_DEFINES)
C_DEFINES = -DUSE_STORPORT=1 $(C_DEFINES)
TARGETLIBS=$(SDK_LIB_PATH)\storport.lib ..\VirtIO\$(O)\virtiolib.lib
!endif

C_DEFINES = -DINDIRECT_SUPPORTED=1 $(C_DEFINES)


INF_TARGET=$(OBJ_PATH)\$(O)\$(TARGETNAME).inf

NTTARGETFILE1=$(INF_TARGET)
PASS1_BINPLACE=$(NTTARGETFILE1)

INCLUDES = $(INCLUDES);..\VirtIO;

SOURCES= virtio_stor.c \
         virtio_stor_utils.c \
         virtio_stor_hw_helper.c \
         virtio_stor.rc \
         virtio_pci.c \

MAJORCOMP=ntos


TARGETLIBS=$(TARGETLIBS) \
         $(SDK_LIB_PATH)\ntoskrnl.lib\
         $(SDK_LIB_PATH)\bufferoverflowk.lib\
         $(SDK_LIB_PATH)\wdm.lib

BUFFER_OVERFLOW_CHECKS=1
MSC_WARNING_LEVEL=/W3 /WX

#ENABLE_EVENT_TRACING=1
#


# select one or none of those
#ENABLE_COM_DEBUG=1
#ENABLE_PRINT_DEBUG=1

!IFDEF ENABLE_COM_DEBUG
C_DEFINES = $(C_DEFINES) -DCOM_DEBUG
!ENDIF

!IFDEF ENABLE_PRINT_DEBUG
C_DEFINES = $(C_DEFINES) -DPRINT_DEBUG
!ENDIF
